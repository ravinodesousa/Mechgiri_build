(this["webpackJsonp@coreui/coreui-free-react-admin-template"]=this["webpackJsonp@coreui/coreui-free-react-admin-template"]||[]).push([[20],{712:function(e,t,a){"use strict";var n=a(713),o={RAZOR_PAY_TEST_KEY:"rzp_live_BXGi4WJt107sJX",apiUrl:"http://api.mechgiri.com/web/",mobileApiUrl:"http://api.mechgiri.com/API/",imgUrlService:"http://api.mechgiri.com/service-icons/",imgUrlBrand:"http://api.mechgiri.com/brand-icons/",imgUrlAds:"http://api.mechgiri.com/mobile-ads/",imgUrlShopImg:"http://api.mechgiri.com/shop-img/",noImage:a.n(n).a};t.a=o},713:function(e,t,a){e.exports=a.p+"static/media/no_image.104a1a91.png"},715:function(e,t,a){"use strict";function n(){var e=JSON.parse(localStorage.getItem("user"));return e&&e.accessToken?{"Content-Type":"application/json","x-access-token":e.accessToken}:{}}a.d(t,"a",(function(){return n}))},723:function(e,t,a){"use strict";function n(){var e=JSON.parse(localStorage.getItem("user"));return e&&e.accessToken?{"x-access-token":e.accessToken}:{}}a.d(t,"a",(function(){return n}))},883:function(e,t,a){"use strict";a.r(t);var n,o=a(721),l=a(203),r=a(198),i=a(199),s=a(202),c=a(201),m=a(200),u=a(718),d=a(1),p=a.n(d),h=a(717),f=a(204),b=a(712),v=a(715),E=a(723),y=a(728),g=a(732),S=a.n(g),A=a(725),k=a.n(A),w=a(719),F=a(714),T=Object(F.css)(n||(n=Object(u.a)(["\n  display: block;\n  border-color: black;\n  position: absolute;\n  left: 43%;\n  top: 50%;\n  z-index: 1;\n"]))),N=null,j=null,D=null,P=null,x=JSON.parse(localStorage.getItem("user")).id,O=function(e){Object(c.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).paymentStatus=function(e,t){return"unpaid"===e?t?p.a.createElement(h.a,{className:"mr-1",color:"primary"},"INITIATED"):p.a.createElement(h.a,{className:"mr-1",color:"danger"},"UNPAID"):"paid"===e?p.a.createElement(h.a,{className:"mr-1",color:"success"},"PAID"):void 0},n.serviceStatus=function(e,t,a,n){return"rejected"===e?p.a.createElement(h.a,{className:"mr-1",color:"danger"},"Rejected"):"accepted"===e?t?p.a.createElement(p.a.Fragment,null,p.a.createElement(h.a,{className:"mr-1",color:"danger"},"ISSUE RAISED"),p.a.createElement("br",null),p.a.createElement("span",{style:{fontWeight:"bold"}},"Reason:"," ",p.a.createElement("span",{style:{color:"red",fontWeight:"bolder"}},n))):a?p.a.createElement(h.a,{className:"mr-1",color:"secondary"},"ISSUE RESOLVED"):p.a.createElement(h.a,{className:"mr-1",color:"success"},"Accepted"):"pending"===e?p.a.createElement(h.a,{className:"mr-1",color:"primary"},"Pending"):void 0},n.serviceAction=function(e,t,a,o,l,r){return console.log(e+t+a),p.a.createElement("div",{style:{width:"140px"}},"pending"==a&&p.a.createElement("button",{className:"btn cancel-btn",onClick:function(){return n.acceptApplication(e,t,"accepted")}},p.a.createElement("i",{className:"fa fa-check"})),"pending"==a&&p.a.createElement("button",{className:"btn cancel-btn",onClick:function(){return n.acceptApplication(e,t,"rejected")}},p.a.createElement("i",{className:"fa fa-remove"})),"accepted"==a&&"unpaid"==o&&!(null===r||void 0===r?void 0:r.isPaymentInitiated)&&!(null===r||void 0===r?void 0:r.isEscalated)&&p.a.createElement("button",{className:"btn cancel-btn",onClick:function(){n.setState({showPaymentModal:!0,selectedAppointment:{id:e,token:t},amount:l,amountError:"",payableAmount:0,payableAmountError:"",serviceBreakdownFile:null,serviceBreakdownFileError:""})}},p.a.createElement("i",{className:"fa fa-money"})),p.a.createElement(f.b,{className:"btn cancel-btn",to:{pathname:"/application-details",data:e}},p.a.createElement("i",{className:"fa fa-info"})))},n.acceptApplication=function(e,t,a){var o={id:e,status:a,token:t};k()({title:"Are you sure?",text:"The request status will be changed!",icon:"warning",buttons:!0,dangerMode:!0}).then((function(e){e&&(k()("Status updated successfully!",{icon:"success"}),fetch(b.a.apiUrl+"update_application",{method:"POST",headers:Object(v.a)(),body:JSON.stringify(o)}).then((function(e){return e.json()})).then((function(e){"success"===e?n.componentDidMount():n.props.history.push("/404")})).catch((function(e){console.error(e),n.props.history.push("/404")})))}))},n.handleChange=function(e){return function(t){n.setState(Object(l.a)({},e,t.target.value)),n.setState(Object(l.a)({},e+"Error",""))}},n.initiatePaymentHandler=function(){var e=!1;if(null==n.state.serviceBreakdownFile?(n.setState({serviceBreakdownFileError:"Select Service Breakdown Image"}),e=!0):n.setState({serviceBreakdownFileError:null}),null==n.state.payableAmount||""==n.state.payableAmount?(n.setState({payableAmountError:"Enter Payable amount"}),e=!0):isNaN(n.state.payableAmount)?(n.setState({payableAmountError:"Not a valid number"}),e=!0):n.setState({payableAmountError:null}),!e){var t,a,o,l;n.setState({loading:!0});var r=new FormData;r.append("serviceBreakdownFile",n.state.serviceBreakdownFile),r.append("payableAmount",n.state.payableAmount),r.append("id",null!==(t=null===(a=n.state.selectedAppointment)||void 0===a?void 0:a.id)&&void 0!==t?t:""),r.append("token",null!==(o=null===(l=n.state.selectedAppointment)||void 0===l?void 0:l.token)&&void 0!==o?o:""),fetch(b.a.apiUrl+"initiate_appointment_payment",{method:"POST",headers:Object(E.a)(),body:r}).then((function(e){return e.text()})).then((function(e){console.log("responseJsonFromServerData",e),"success"===e?(n.setState({showPaymentModal:!1}),k()("Payment initiated successfully!",{icon:"success"}),setTimeout((function(){n.componentDidMount()}),2500)):n.props.history.push("/404")})).catch((function(e){console.error(e),n.props.history.push("/404")}))}},n.onChangeFile=function(e){var t=e.target.files[0],a=!1;t||(console.log("1"),n.setState({serviceBreakdownFileError:"Please select file",serviceBreakdownFile:null}),a=!0),t.name.match(/\.(jpg|jpeg|png)$/)||(console.log("2"),n.setState({serviceBreakdownFileError:"Please select valid file. Allowed types (jpg | jpeg | png)",serviceBreakdownFile:null}),a=!0),Math.round(t.size/1024)>2048&&(console.log("3"),n.setState({serviceBreakdownFileError:"Max file size 2MB",serviceBreakdownFile:null}),a=!0),!1===a?n.setState({serviceBreakdownFile:e.target.files[0],serviceBreakdownFileError:""}):(console.log("failed"),n.setState({serviceBreakdownFile:null}))},n.filter=function(e,t){var a=[];if(n.setState({appointmentId:e,filterType:t}),"reset"===t){var o={};N=null,j=null,D=null,P=null,n.setState({statusTypeFilter:"",fromDateTypeFilter:"",toDateTypeFilter:""})}if("from"===t&&(n.setState({fromDateTypeFilter:e}),N=new Date(e),D=e),"to"===t&&(n.setState({toDateTypeFilter:e}),j=new Date(e),P=e),null!=N&&null!=j)if(N.getTime()>=j.getTime())k()("From Date should be greater than To Date");else if(N.getTime()<j.getTime()){console.log("correct");o={fromDate:D,toDate:P,id:x}}n.setState({loading:!0}),fetch(b.a.apiUrl+"get_applications_by_id",{method:"POST",headers:Object(v.a)(),body:JSON.stringify(o)}).then((function(e){return e.json()})).then((function(e){console.log(e),e.map((function(e,t){var o,l={client:e.user,phone:e.mobileNumber,date:S()(e.appointmentDate).format("MMM Do YYYY"),time:S()(e.appointmentTime,"hh:mm:ss").format("hh:mm A"),status:n.serviceStatus(e.isApproved,e.isEscalated,e.isResolved,null===e||void 0===e?void 0:e.escalationReason),payment_status:n.paymentStatus(null===e||void 0===e?void 0:e.paid,null===e||void 0===e?void 0:e.isPaymentInitiated),action:n.serviceAction(e.id,e.firebaseToken,e.isApproved,null===e||void 0===e?void 0:e.paid,null!==(o=null===e||void 0===e?void 0:e.amount)&&void 0!==o?o:0,e)};a.push(l)})),n.setState({data:a,loading:!1})})).catch((function(e){console.error(e),n.setState({loading:!1}),n.props.history.push("/404")}))},n.serviceAction=n.serviceAction.bind(Object(s.a)(n)),n.filter=n.filter.bind(Object(s.a)(n)),n.state={data:[],loading:!1,fromDateTypeFilter:"",toDateTypeFilter:"",statusTypeFilter:"",appointmentId:"null",filterType:"",showPaymentModal:!1,selectedAppointment:null,amount:0,amountError:"",payableAmount:0,payableAmountError:"",serviceBreakdownFile:null,serviceBreakdownFileError:""},n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this,t={id:x},a=[];this.setState({loading:!0}),fetch(b.a.apiUrl+"get_applications_by_id",{method:"POST",headers:Object(v.a)(),body:JSON.stringify(t)}).then((function(e){return e.json()})).then((function(t){console.log(t),t.map((function(t,n){var o,l={client:t.user,phone:t.mobileNumber,date:S()(t.appointmentDate).format("MMM Do YYYY"),time:S()(t.appointmentTime,"hh:mm:ss").format("hh:mm A"),status:e.serviceStatus(t.isApproved,t.isEscalated,t.isResolved,null===t||void 0===t?void 0:t.escalationReason),payment_status:e.paymentStatus(null===t||void 0===t?void 0:t.paid,null===t||void 0===t?void 0:t.isPaymentInitiated),action:e.serviceAction(t.id,t.firebaseToken,t.isApproved,null===t||void 0===t?void 0:t.paid,null!==(o=null===t||void 0===t?void 0:t.amount)&&void 0!==o?o:0,t)};a.push(l)})),e.setState({data:a,loading:!1})})).catch((function(t){console.error(t),e.setState({loading:!1})}))}},{key:"render",value:function(){var e=this,t={columns:[{label:"Client",field:"client",sort:"disabled",width:150,attributes:{"aria-controls":"DataTable","aria-label":"Icon"}},{label:"Contact No.",field:"phone",sort:"disabled",width:200},{label:"Appointment Date",field:"date",sort:"disabled",width:200},{label:"Appointment Time",field:"time",sort:"disabled",width:100},{label:"Status",field:"status",sort:"disabled",width:150},{label:"Payment Status",field:"payment_status",sort:"disabled",width:150},{label:"Action",field:"action",sort:"disabled",width:270}],rows:Object(o.a)(this.state.data)};return p.a.createElement(p.a.Fragment,null,p.a.createElement(h.Q,null,p.a.createElement(h.j,null,p.a.createElement(h.f,null,p.a.createElement(w.ScaleLoader,{height:40,width:12,css:T,size:150,color:"#B54545",loading:this.state.loading}),p.a.createElement(h.i,null,p.a.createElement(h.Q,null,p.a.createElement(h.j,{sm:"6",xs:"8",md:"8"},p.a.createElement("h3",null,"Bookings")),p.a.createElement(h.j,{sm:"6",xs:"4",md:"4"}))),p.a.createElement(h.g,null,p.a.createElement(h.Q,null,p.a.createElement(h.j,{md:"3",sm:"3",xs:"12"},p.a.createElement(h.x,{autoFocus:!0,type:"date",onChange:function(t){return e.filter(t.target.value,"from")},value:this.state.fromDateTypeFilter,style:{margin:"5px"}})),p.a.createElement(h.j,{md:"3",sm:"3",xs:"12"},p.a.createElement(h.x,{type:"date",onChange:function(t){return e.filter(t.target.value,"to")},value:this.state.toDateTypeFilter,style:{margin:"5px"}})),p.a.createElement(h.j,{md:"3",sm:"3",xs:"12"},p.a.createElement(h.d,{onClick:function(t){return e.filter(t.target.value,"reset")},style:{margin:"5px"},className:"btn submit-btn"},"Reset"))),p.a.createElement(h.Q,null,p.a.createElement(h.j,{md:"12",sm:"12",xs:"12"},p.a.createElement(y.c,{hover:!0,entriesOptions:[6,10],entries:6,pagesAmount:4,data:t,pagingTop:!0,searchTop:!0,searchBottom:!1,barReverse:!0,responsive:!0}))))))),p.a.createElement(h.H,{centered:!0,show:this.state.showPaymentModal,onClose:function(){return e.setState({showPaymentModal:!1})}},p.a.createElement(h.K,null,p.a.createElement(h.L,null,"Initiate Payment")),p.a.createElement(h.I,null,p.a.createElement("form",{id:"initiatePaymentForm"},p.a.createElement(h.t,null,p.a.createElement(h.F,{htmlFor:"amount"},"Approx Amount"),p.a.createElement(h.x,{autoFocus:!0,type:"text",placeholder:"Enter Approx Amount",onChange:this.handleChange("amount"),style:{borderColor:""===this.state.amountError?"":"red"},value:this.state.amount,disabled:!0})),p.a.createElement("p",{className:"error",style:{display:""===this.state.amountError?"none":"block"}},p.a.createElement("i",{className:"fa fa-exclamation-triangle"})," ",this.state.amountError),p.a.createElement("br",null),p.a.createElement(h.t,null,p.a.createElement(h.F,{htmlFor:"payableAmount"},"Payable Amount"),p.a.createElement(h.x,{autoFocus:!0,type:"text",placeholder:"Enter Payable Amount",onChange:this.handleChange("payableAmount"),style:{borderColor:""===this.state.payableAmountError?"":"red"}})),p.a.createElement("p",{className:"error",style:{display:""===this.state.payableAmountError?"none":"block"}},p.a.createElement("i",{className:"fa fa-exclamation-triangle"})," ",this.state.payableAmountError),p.a.createElement("br",null),p.a.createElement(h.t,null,p.a.createElement(h.F,{htmlFor:""},"Service breakdown file"),p.a.createElement(h.z,{id:"",name:"",onChange:this.onChangeFile})),p.a.createElement("p",{className:"error",style:{display:""===this.state.serviceBreakdownFileError?"none":"block"}},p.a.createElement("i",{className:"fa fa-exclamation-triangle"})," ",this.state.serviceBreakdownFileError))),p.a.createElement(h.J,null,p.a.createElement(h.d,{color:"secondary",onClick:function(){return e.setState({showPaymentModal:!1})}},"Close"),p.a.createElement(h.d,{color:"primary",onClick:function(){e.initiatePaymentHandler()}},"Send Payment Request"))))}}]),a}(d.Component);t.default=O}}]);
//# sourceMappingURL=20.05baf493.chunk.js.map